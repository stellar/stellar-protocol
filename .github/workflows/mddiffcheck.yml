name: 'Check CAP Diffs'

on:
  push:
    branches:
    - master
    - testmddiffcheck
  pull_request:

jobs:
  mddiffcheck:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: ^1.16
    - run: go install github.com/stellar/mddiffcheck@v1.1.0
    - run: |
          failed=0
          for f in core/*.md; do
            echo Checking "$f":
            mddiffcheck -repo https://github.com/stellar/stellar-core "$f" || \
            mddiffcheck -repo https://github.com/stellar/stellar-xdr "$f" || {
              failed=1
            }
            echo
          done
          exit $failed
