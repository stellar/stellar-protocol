## Preamble

```
CAP: <to be assigned>
Title: Remove txINTERNAL_ERROR transaction result code
Author: Rafał Przemysław Malinowski (rafal@stellar.org)
Status: Draft
Created: 2017-08-15
```

## Simple Summary
txINTERNAL_ERROR transaction result code should be removed to allow for
simpler alternative clients of Stellar Protocol.

## Abstract
Current protocol includes txINTERNAL_ERROR as a possible result of submitting
transaction to Stellar Network. It is documented as "an unknown error occured".
This makes implementing alternative clients of Stellar Protocol hard as they
must exactly replicate internal errors of stellar-core.

## Motivation
Current protocol includes txINTERNAL_ERROR as a possible result of submitting
transaction to Stellar Network. It is documented as "an unknown error occured".
The only one existing implementation of Stellar Protocol uses this result code
in following way (code simplified):

    try
    {
        applyTransaction();
    }
    catch (...)
    {
        transactionResult = txINTERNAL_ERROR;
    }

This snippet of code means that usage of txINTERNAL_ERROR depends on conditions
that cannot be specified - mostly on internal bugs of stellar-core client. One
of the cases when this error code was used on live network was when databases
of SDF nodes were inproperly configured (with missing fields in one of the
tables).

Result code of transaction is used as part of seed of hash of ledger in which
this transaction was about to be applied. This means that only clients that use
exactly the same transaction result code for each transaction can be used in
Stellar Network - when result codes are different, ledger hashes are different
and no consensus can be made.

It is better to crash a Stellar Protocol client in case of internal unknown
error instead of returning txINTERNAL_ERROR code.

## Specification
For protocol versions 9 and later each Stellar Protocol client should crash
instead of returning txINTERNAL_ERROR result code. Dump of transaction that
causes crash must be stored for inspection.

## Rationale
Crashing Stellar Protocol clients instead of txINTERNAL_ERROR will allow (and
force) faster diagnostics and fixing of bugs in implementations. Until network
is build only of nodes of one type (stellar-core), it will be possible to do
a DOS attack with a transaction that will trigger known bug in implementation.
This kind of bugs requires adding a log message in try catch statement to
identify failing transaction and to allow making a quick fix of a bug.
When network will consist of multiple types of nodes, such bug will only remove
one type of nodes from the network (it is unlikely two implementations will
have the same implementation bugs).

Leaving txINTERNAL_ERROR will require synchronizing every implementation of
Stellar Protocol in regards of internal bugs. This is not an easy task and will
make code of the implementations very noisy and hard to debug.

## Backwards Compatibility
This change uses protocol versioning to deal with backwards compatibility.
txINTERNAL_ERROR must still be supported for protocol version 8 and less.
After this change is implemented it will be possible to move support of
txINTERNAL_ERROR to a specialized function that checks if hash of transaction
matches a hardcoded list of transactions that triggered that result code in the
past. It is assumed that this list is very short (less than 10 items).

## Test Cases
After implementing this change a full catchup must be performed on both test
and public network.

## Implementation
Implementation will be done when (if) this CAP is accepted.
