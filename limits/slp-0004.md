## Preamble

```
SLP: 0004
Title: Increase Ledger Wide Limits for Soroban  
Authors: Dmytro Kozhevin <@dmkozh> 
Consulted: Tomer Weller <@tomerweller>, Nicolas Barry <@monsieurnicolas>, Tamir Sen <@tamirms>
Status: Accepted
Created: 2026-01-12
Discussion: https://github.com/orgs/stellar/discussions/1850
```

## Summary

This proposal suggests increasing most of the Soroban ledger and transaction limits, and adjusts the disk reads that have been overlooked since p23 update.

## Goals Alignment

Increasing the limits will support existing protocols while allowing room for efficient and scalable everyday financial services.

## Proposed Limits

The summary of the proposed changes is as follows:

| Resource                  | Current Per-tx | Proposed Per-tx | Current Ledger | Proposed Ledger | New Ledger/Tx Ratio |
|---------------------------|----------------|-----------------|----------------|-----------------|---------------------|
| Disk Read Entries         | 100            | 200             | 1000           | 1000            | 5                   |
| Disk Read Bytes           | 200000         | 200000          | 7000000        | 400000          | 2                   |
| Write Entries             | 50             | 200             | 500            | 1000            | 5                   |
| Write Bytes               | 132096         | 132096          | 143360         | 286720          | 2.17                |
| Tx Size Bytes             | 132096         | 132096          | 133120         | 266240          | 2.01                |
| Instructions/threads      | 100'000'000    | 400'000'000     | 600'000'000 / 1 thread | 580'000'000 / 2 threads | 2.9 |

Additionally, footprint size increase from 100 to 200 entries is proposed.

## Limit Change Rationale

### Increase of the ledger limits

Transaction size and write bytes ledger limits are often utilized at ~100%, and write entries are at up to 85%, and thus the increase is proposed to all of these in order to increase the network throughput.

Instruction utilization is usually at 50%, but with introduction of heavy-weight ZK functions in protocol 25 an increase in demand is anticipated. Since a lot of headroom has been unlocked in protocol 23 thanks to parallel transaction application, we propose increasing the number of apply threads to proactively address the potential demand and allow for faster protocol scaling. The per-thread instructions have been decreased slightly as a result of benchmarking.

Transaction count can be increased proportionally as well to accommodate for the increased throughput.

### Increase of the transaction limits

With the increase of the ledger limits, it's safe to increase the corresponding transaction limits as well, as now they occupy a smaller percentage of the ledger capacity.

Larger footprint sizes allow for better batch processing via Soroban (such as batch payments or mints).

The increase of the instructions limit specifically also accommodates for the potential computation-heavy protocols, such as ZK-based protocols.

### Decrease of the ledger disk read bytes

With introduction of protocol 23 read bytes limit has been removed, and only disk read bytes are counted towards the ledger limits. Disk reads are only reads of the restored entries (which are also implicitly limited by the write bytes), and reads of the 'classic' entries (which have a small and bounded size). Thus it's safe to set the ledger disk read bytes limit slightly above the ledger write bytes limit without affecting any legitimate use case.

## Evaluation

### Benchmarking

Benchmarking has been performed on AWS c5d.2xlarge instance with Stellar Core 25.1.0 build.

### Evaluation of current limits

SLP-3 scenarios for the current ledger limits have been re-evaluated, as the benchmark has changed since protocol 23 (e.g. the modelled/real instructions ratio has changed due to module cache).

1. Transactions configured with 100M instructions, 5 RW entries, 500 bytes per entry. 6 TPL.
   - Ledger close min/avg/max: 277/281/287 milliseconds

3. Transactions configured with 50M instructions, 50 RO entries, 50 RW entries, 240 bytes per entry. 10 TPL.
   - Ledger close min/avg/max: 276/288/306 milliseconds

RO entries are omitted, as most of the reads are in-memory and non-metered now. Scenario 2 is skipped for the same reason, as it tests RO-only entries, which don't make an interesting scenario anymore.


### Update to benchmarking targets

Note, that the close time has increased since SLP-3. Given that the network performance hasn't degraded since then, we propose to relax the threshold for the Soroban apply time to 300ms. The previous threshold of 250ms was very conservative, and a relatively small increase to it shouldn't be able to compromise the network stability.

### Benchmarking with proposed limits

#### Execution

The following scenarios have been evaluated to cover the 'edge' cases of a small number of large transactions, and high number of small transactions:

1. Transactions configured with 96.6M instructions, 83 RW entries, 280 bytes per entry. 12 TPL.
  - Ledger close min/avg/max: 290/298/307 milliseconds

2. Transactions configured with 2.32M instructions, 2 RW entries, 286 bytes per entry. 493 TPL.
  - Ledger close min/avg/max: 258/273/287 milliseconds

#### Impact of tx size on overlay

  In addition to execution benchmarking, end-to-end simulation testing was performed on a 591-node network using the supercluster PubnetNetworkLimitsBench mission with a connectivity snapshot from Mainnet. To imitate current Mainnet traffic, tests always generated 200 TPS of classic load, plus varying amounts of InvokeHost load to completely saturate the transaction size ledger limit. Ledger close time remained stable at ~300ms. The following profiles were evaluated:

  1. Max-size transactions: 132,096 bytes, 2 TPL
  2. Medium-size transactions: 40,000 bytes, 6 TPL
  3. Small-size transactions: 2,000 bytes, 132 TPL

  Overall, in all three scenarios the network remained healthy, with ledger age mostly comparable to behavior under the SLP3 transaction size limit (i.e., 7 seconds or less). Slight degradations in individual subsystems, such as nomination, were observed on some non-validating nodes, along with occasional nomination spikes on Tier 1 nodes in p99 latency. The health of the system overall, and Tier 1 in particular, remained largely unchanged.

### Downstream impact

The increase in the total size of transactions, as well as increase in the total write size leads to the proportional increase in the ledger close metadata emitted by the Stellar Core.

Stellar Horizon has been benchmarked as one of the known slower consumers of the metadata. Benchmark was set up with the maxed-out transaction size and ledger write dimensions, as well as traffic of 1000 additional 'classic' payment transactions to simulate the 'classic' metadata. The ingestion of the benchmark data took ~1.3s on average, which can be considered sufficient given the 5s ledger close cadence.

Note, that there are many metadata consumers, so this benchmark can't be considered exhaustive. However, it provides a representative data point - even for a complex ingestion system it still takes <30% of the ledger time to ingest the increased metadata.

### Transaction 

### Long-term protocol impact

This SLP proposes increases to a number of per-transaction limits. Footprint-related changes are unlikely to have significant long-term impact, as it's unlikely that the respective ledger limits will need to go down significantly, and thus these should remain low enough relatively to the ledger limits in the long term.

The instruction limit increase is significant and it limits the ability to reduce per-thread instruction count. Specifically, if ledgers are closed more often and with more threads, every thread still must be able to apply at least 300M instructions. However, even with a rather conservative estimate of 50% per-thread overhead (due to imperfect parallelization), we would still end up with ~300ms ledger close time, which should be acceptable even given much higher ledger close frequency. As a reference point, with the current build of Stellar Core a benchmark for 300M instructions per thread and 8 threads, 1000 transactions per ledger, and 1000 entries/286KB of writes takes 342ms on average. Note, that some amount of future optimization is assumed here (such as parallelizing some steps that are currently sequential).

## Evaluation Outcome

The proposed limits increase can be considered acceptable with the following caveats detailed above:

- Average ledger close time benchmark requirement is relaxed to 300ms
- There are certain assumptions about the long term impact of the instruction increase, which must be valid for the proposal to make sense

## Fees update

In addition to increasing the resource capacity, this proposes to also lower the fees for non-refundable resources 4 times. There is currently no evidence that would suggest that the current non-refundable fees are too low, as there is no significant spammy activity on-chain that would cause real surge pricing pressure (i.e. even if some transactions are dropped, the inclusion fees normally stay at the base level of 100 stroops). Thus we propose to reduce non-refundable fees.

The motivation for specifically 4 times reduction is that it's a straightforward strategy (vs per-resource fee adjustment), and the resource capacity has grown ~4x since Soroban launch for most resources. Some resources went up more or less, but that also has something to do with more or less conservative approaches to different resources on launch. The event cost reduction is just a rather conservative step - there is no limited capacity for this, so we could lower the cost while it still remains safe enough to prevent abuse.

Summary of the fee updates:

| Resource               | Current fee | Discount rate | Proposed Fee |
|------------------------|-------------|---------------|--------------|
| Insns (fee per 10K)    | 25          | 4             | 7            |
| Disk read 1 entry      | 6,250       | 4             | 1,563        |
| Disk read 1 KB         | 1,786       | 4             | 447          |
| Write 1 entry          | 10,000      | 4             | 2,500        |
| Write 1 KB             | 3,500       | 4             | 875          |
| 1 KB tx size (bandwidth) | 1,624     | 4             | 406          |
| 1 KB tx size (history) | 16,235      | 4             | 4,059        |
| 1 KB events            | 10,000      | 2             | 5,000        |